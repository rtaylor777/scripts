#!/bin/bash
# Author: Robert Taylor
# Date: April 4, 2023
# Purpose: Searches through the ExploitDB files located in /usr/share/exploitdb/exploits/ for
# any line that has the word "port" followed by a number matching the number that you are searching
# for. Chances are pretty good that a match will be the port # that you are looking for.
if [[ ! "$1" ]]; then
	echo "Usage: $0 <port>";
	echo "Example: $0 587";
	exit 0;
fi
port="$1"
regex="^.*/([0-9]+)\..*$";
cd /usr/share/exploitdb/exploits/;
echo "Use caution, some lines/exploits could match that have nothing to do with the port $1";
echo
${IFS+"false"} && unset oldifs || oldifs="$IFS"    # correctly backup/store IFS.
IFS=$'\n';
for line in $(egrep -roi " port[= ].*[^0-9]$port[^0-9]" *); do
	#echo $line;
	if [[ "$line" =~ $regex ]]; then
		echo "Matched line from file: $line"
		searchsploit -p "${BASH_REMATCH[1]}";
		echo
	fi
done
${oldifs+"false"} && unset IFS || IFS="$oldifs"    # restore IFS.
exit 0;
